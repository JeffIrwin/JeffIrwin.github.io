
<link rel="shortcut icon" type="image/png" href="favicon.png">

{% include header.md %}

# Abstract interfaces: setting fractal iterator functions at runtime in Fortran

2021 Dec 11

Fractal images are generated by calling an *iterator function* many times on the 2D coordinates *c* for each pixel in the image.  Colors in the image are assigned depending on how many iterations it takes for a point to *escape* beyond a certain beyond a certain radius, if it escapes at all.

Two common fractals are the [Mandelbrot set](https://en.wikipedia.org/wiki/Mandelbrot_set) and the [burning ship fractal](https://en.wikipedia.org/wiki/Burning_Ship_fractal).

TODO: figures

The only difference between these fractals is the iterator function.  For the Mandelbrot set, the iterator function is:

| (1) | ![](resources/mandelbrot-itr-func.svg) |

while for the burning ship, it is:

| (2) | ![](resources/burning-ship-itr-func.svg) |

Under the hood, pretty much everything about a program that creates fractal images is the same, regardless of the choice of fractal iterator function.

Thus, in accordance with the [DRY principle](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself), it makes sense to have a single program that can create fractal images for any iterator function.

Now we are faced with a problem of how to swap out one iterator function for another at runtime.  A user may choose to define the iterator function as Equation (1) or as Equation (2).  How can we set the function in a DRY and computationally efficient way?

The solution is [abstract interfaces](https://www.intel.com/content/www/us/en/develop/documentation/fortran-compiler-oneapi-dev-guide-and-reference/top/language-reference/a-to-z-reference/a-to-b/abstract-interface.html), [procedure pointers](https://www.intel.com/content/www/us/en/develop/documentation/fortran-compiler-oneapi-dev-guide-and-reference/top/language-reference/program-units-and-procedures/procedure-pointers.html), and [callbacks](https://en.wikipedia.org/wiki/Callback_(computer_programming)).

