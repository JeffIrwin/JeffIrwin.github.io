
{% include header.md %}

<!-- # Injecting date and time into a GitHub page with Jekyll -->

# Jekyll injection

## Adding date and time to a GitHub page

### 2021 Dec 31

It's a problem we've all faced.  You make an earth-shattering edit to your blog on [GitHub pages](https://pages.github.com/){:target="blank"}, commit, push, and refresh your browser to see the changes.  But wait: are you looking at the edited page, or the old version?  You watch the page build [GitHub action](https://github.com/features/actions){:target="blank"} to confirm that it completed, but has the deployment trickled all the way down yet?

The only way to really know which version you're looking at is to add the build time or git revision somewhere on your page.  Jekyll even offers the `site.github.build_revision` [for the latter](https://github.com/jekyll/github-metadata/blob/master/docs/configuration.md){:target="blank"}.

We're going to look at a more flexible solution that can be extended to other automated page modifications, which will eventually look like this:

_Build: Fri Dec 31 01:03:45 UTC 2021, revision: `f7c5b70`_

## Setup your template page source with variables to be replaced

In my example, I'm working on the `_layouts/default.html` page.  You can run the injection on `index.md` or any other html or markdown translation unit.

We don't want the injection to modify our source code and we don't care about version control on the output of the injection process.  So, move your source to a template that will be the source of truth:

    mv _layouts/default.html _layouts/default-template.html

Make sure the template filename starts with `_` or `.` to be ignored by Jekyll.  In the future, do all of your editing on the template file rather than the one that gets automatically modified.

Next, [add the content](https://github.com/JeffIrwin/JeffIrwin.github.io/blob/4b9b3923903862b58c009129dee710111e2a21e7/_layouts/default-template.html#L94){:target="blank"} where you're going to inject variables:

    <p>Build: BUILD_DATE, revision: <code>BUILD_REVI</code></p>

The variable identifiers are `BUILD_DATE` and `BUILD_REVI`.

Be careful that these identifiers don't appear elsewhere in your source where you want them to be literal and unmodified.  Perhaps add some [sigil](https://en.wikipedia.org/wiki/Sigil_(computer_programming)){:target="blank"} like `$VARIABLE` as an extra guard against the dumb parsing that we're about to do.

## Use `sed` to search and replace the template variables and generate your page source

In this example, there are some handy bash and git commands to get the data that we want to inject.

First, copy the template file to the injected output file.  Then inject the data:

        cp _layouts/default-template.html _layouts/default.html

        date=$(date)
        revi=$(git rev-parse --short HEAD)

        sed -i "s/BUILD\_DATE/$date/g" _layouts/default.html
        sed -i "s/BUILD\_REVI/$revi/g" _layouts/default.html

Recall that the `var=$(command)` syntax saves the output of a bash command in a variable.

## Build and deploy the page

Because we're modifying the page source, we can't use the default Jekyll GitHub pages workflow.  We need to make a custom `jekyll.yml` workflow.

TBD

I'm using JamesIves/github-pages-deploy-action.  To guard against a left-pad (LINK) fiasco, I forked it and use `pgh` (LINK) git helper to keep it up to date.

