<!DOCTYPE html>
<html lang="en-US">
  <head>

    <!--
      Source:
      https://github.com/pages-themes/cayman/blob/master/_layouts/default.html
    -->

    

    <!--
    
    -->

    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>JeffIrwin.github.io | Jeff Irwin’s GitHub page</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="JeffIrwin.github.io" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jeff Irwin’s GitHub page" />
<meta property="og:description" content="Jeff Irwin’s GitHub page" />
<link rel="canonical" href="https://www.jeffirwin.xyz/posts/2021-12-31-a.html" />
<meta property="og:url" content="https://www.jeffirwin.xyz/posts/2021-12-31-a.html" />
<meta property="og:site_name" content="JeffIrwin.github.io" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="JeffIrwin.github.io" />
<script type="application/ld+json">
{"headline":"JeffIrwin.github.io","description":"Jeff Irwin’s GitHub page","url":"https://www.jeffirwin.xyz/posts/2021-12-31-a.html","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=44e4b8466c5799c67e59c0748e38871f50d482bd">
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <style>
        /* Style the tab */
        .tab {
          overflow: hidden;
          border: 1px solid #ccc;
          background-color: #f1f1f1;
        }

        /* Style the buttons that are used to open the tab content */
        .tab button {
          background-color: inherit;
          float: left;
          border: none;
          outline: none;
          cursor: pointer;
          padding: 14px 16px;
          transition: 0.3s;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
          background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
          background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
          display: none;
          /*padding: 6px 12px;*/
          border: 1px solid #ccc;
          border-top: none;
        }
    </style>
  </head>
  <body>

    <header class="page-header" role="banner">

      <h1 class="project-name">jeffirwin.xyz</h1>

      <h2 class="project-tagline" id="tagline">Computers are useless, they can only give you answers</h2>

      <script>

        s =
          [
              "Computers are useless, they can only give you answers",
              "You should never ask an engineer to explain anything because he will",
              "The programmer's wife tells him: \"Run to the store and pick up a loaf of bread. If they have eggs, get a dozen.\"  The programmer comes home with 12 loaves of bread",
              "Everyone knows that debugging is twice as hard as writing a program in the first place.  So if you're as clever as you can be when you write it, how will you ever debug it?",
              "Res severa verum gaudium",
              "A human with a bicycle becomes the most efficient animal",
              "Fool me once, shame on you.  But teach a man to fool me and I'll be fooled for the rest of my life",
              "A machine is more blameless, more sinless even than any animal.  It has no intentions whatsoever but our own",
              "I don't want to live in a world where someone else makes the world a better place better than I do",
              "You either believe in the law of the excluded middle or you don't",
              "God is real, unless declared integer",
              "There are only two hard problems in computer science: cache invalidation, naming things, and off-by-one errors",
              "The existence of negative numbers was a subject of much speculation in mathematics beginning in the -12th Century",
              "No bird soars in a calm"
          ];

        document.getElementById("tagline").innerHTML = s[Math.floor(Math.random() * s.length)];

      </script>

      
      
    </header>

    <main id="content" class="main-content" role="main">
      
<table>
  <tbody>
    <tr>
      <td><a href="https://www.jeffirwin.xyz">Home</a></td>
      <td><a href="https://www.jeffirwin.xyz/music">Music</a></td>
      <td><a href="https://www.jeffirwin.xyz/posts">Posts</a></td>
      <td><a href="https://www.jeffirwin.xyz/about">About</a></td>
    </tr>
  </tbody>
</table>

<!-- # Injecting date and time into a GitHub page with Jekyll -->

<h1 id="jekyll-injection">Jekyll injection</h1>

<h2 id="adding-date-and-time-to-a-github-page">Adding date and time to a GitHub page</h2>

<h3 id="2021-dec-31">2021 Dec 31</h3>

<p>It’s a problem every developer has faced (it me, I’m every developer).  You make an earth-shattering edit to your blog on <a href="https://pages.github.com/" target="blank">GitHub pages</a>, commit, push, and refresh your browser to see the changes.  But wait: are you looking at the edited page, or the old version?  You watch the page build <a href="https://github.com/features/actions" target="blank">GitHub action</a> to confirm that it completed, but has the deployment trickled all the way down yet?</p>

<p>The only way to really know which version you’re looking at is to add the build time or git revision somewhere on your page.  <a href="https://jekyllrb.com/" target="blank">Jekyll</a> even offers the variable <code class="language-plaintext highlighter-rouge">site.github.build_revision</code> <a href="https://github.com/jekyll/github-metadata/blob/master/docs/configuration.md" target="blank">for the latter</a>.</p>

<p>We’re going to look at a more flexible solution that can be extended to other automated page modifications, which will eventually look like this:</p>

<p><em>Build: Fri Dec 31 01:03:45 UTC 2021, revision: <code class="language-plaintext highlighter-rouge">f7c5b70</code></em></p>

<p>Assuming I haven’t broken anything, you can probably see it live at the bottom of this page.</p>

<p>The variables injected into the page will form part of the serum that transforms Jekyll’s markdown into Hyde’s html (or do I have those codeowners backwards?).</p>

<h2 id="setup-your-template-page-source-with-variables-to-be-replaced">Setup your template page source with variables to be replaced</h2>

<p>In my example, I’m working on the <code class="language-plaintext highlighter-rouge">_layouts/default.html</code> page, where my footer is.  You can run the injection on <code class="language-plaintext highlighter-rouge">index.md</code> or any other <code class="language-plaintext highlighter-rouge">html</code> or <code class="language-plaintext highlighter-rouge">md</code> (markdown) translation unit.</p>

<p>We don’t want the injection to modify our source code and we don’t care about version control on the output of the injection process.  So, move your source file to a template that will be the source of truth:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">mv </span>_layouts/default.html _layouts/default-template.html</code></pre></figure>

<p>Make sure the template filename starts with <code class="language-plaintext highlighter-rouge">_</code> or <code class="language-plaintext highlighter-rouge">.</code> so that it is ignored by Jekyll.  We’re good since <code class="language-plaintext highlighter-rouge">default.html</code> is already in the <code class="language-plaintext highlighter-rouge">_layouts</code> folder.  In the future, do all of your editing on the template file rather than the one that gets automatically modified.</p>

<p>Next, <a href="https://github.com/JeffIrwin/JeffIrwin.github.io/blob/89f0290/_layouts/default-template.html#L94" target="blank">add the content</a> where you’re going to inject variables into <code class="language-plaintext highlighter-rouge">default-template.html</code>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;</span>Build: BUILD_DATE, revision: <span class="nt">&lt;code&gt;</span>BUILD_REVI<span class="nt">&lt;/code&gt;&lt;/p&gt;</span></code></pre></figure>

<p>The variable identifiers I have chosen are <code class="language-plaintext highlighter-rouge">BUILD_DATE</code> and <code class="language-plaintext highlighter-rouge">BUILD_REVI</code>.</p>

<p>Be careful that these identifiers don’t appear elsewhere in your source where you want them to be literal and unmodified.  Perhaps add some <a href="https://en.wikipedia.org/wiki/Sigil_(computer_programming)" target="blank">sigil</a> – e.g. <code class="language-plaintext highlighter-rouge">$VARIABLE</code> – as an extra guard against the dumb parsing that we’re about to do.</p>

<h2 id="use-sed-to-search-and-replace-the-template-variables-and-generate-your-page-source">Use <code class="language-plaintext highlighter-rouge">sed</code> to search and replace the template variables and generate your page source</h2>

<p>In this example, there are some handy <code class="language-plaintext highlighter-rouge">bash</code> and <code class="language-plaintext highlighter-rouge">git</code> commands to get the data that we want to inject.</p>

<p>First, copy the template source file to the output destination file to be injected.  Then inject the data with <code class="language-plaintext highlighter-rouge">sed</code>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">srce</span><span class="o">=</span>_layouts/default-template.html
<span class="nv">dest</span><span class="o">=</span>_layouts/default.html
<span class="nb">cp</span> <span class="nv">$srce</span> <span class="nv">$dest</span>

<span class="nb">export </span><span class="nv">TZ</span><span class="o">=</span><span class="s1">'US/Eastern'</span>
<span class="nv">dat</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span>
<span class="nv">rev</span><span class="o">=</span><span class="si">$(</span>git rev-parse <span class="nt">--short</span> HEAD<span class="si">)</span>

<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/BUILD</span><span class="se">\_</span><span class="s2">DATE/</span><span class="nv">$dat</span><span class="s2">/g"</span> <span class="nv">$dest</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/BUILD</span><span class="se">\_</span><span class="s2">REVI/</span><span class="nv">$rev</span><span class="s2">/g"</span> <span class="nv">$dest</span></code></pre></figure>

<p>Recall that the <code class="language-plaintext highlighter-rouge">var=$(command)</code> syntax saves the output of a bash command in a variable.  The syntax for replacing <code class="language-plaintext highlighter-rouge">search</code> with <code class="language-plaintext highlighter-rouge">replace</code> globally in a <code class="language-plaintext highlighter-rouge">file</code> is <code class="language-plaintext highlighter-rouge">sed -i "s/search/replace/g" file</code>.</p>

<p>The underscore <code class="language-plaintext highlighter-rouge">_</code> needs to be escaped in the search pattern like <code class="language-plaintext highlighter-rouge">\_</code>.</p>

<p>Setting the timezone <code class="language-plaintext highlighter-rouge">TZ</code> is optional, it will probably default to <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" target="blank">UTC</a> otherwise.</p>

<p>Short of sigils, we can get little a extra protection by only replacing whole words that match the search pattern, by marking the beginning and ending word boundaries with <code class="language-plaintext highlighter-rouge">\&lt;</code> and <code class="language-plaintext highlighter-rouge">\&gt;</code> respectively:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/</span><span class="se">\&lt;</span><span class="s2">BUILD</span><span class="se">\_</span><span class="s2">DATE</span><span class="se">\&gt;</span><span class="s2">/</span><span class="nv">$dat</span><span class="s2">/g"</span> <span class="nv">$dest</span></code></pre></figure>

<p>Alternatively, if you don’t want to use <code class="language-plaintext highlighter-rouge">sed</code>, you could generate an entire footer file with <code class="language-plaintext highlighter-rouge">echo</code>, <code class="language-plaintext highlighter-rouge">cat</code>, etc.  For the <a href="https://github.com/pages-themes/cayman" target="blank">Jekyll cayman theme</a>, the footer is part of <code class="language-plaintext highlighter-rouge">default.html</code>, so it seems easier to use <code class="language-plaintext highlighter-rouge">sed</code> instead of generating all of <code class="language-plaintext highlighter-rouge">default.html</code> from scratch.</p>

<h2 id="build-and-deploy-the-page">Build and deploy the page</h2>

<p>Because we’re modifying the page source after every commit, we can’t use the default Jekyll GitHub pages workflow.  We need to use a <a href="https://github.com/JeffIrwin/JeffIrwin.github.io/blob/89f0290/.github/workflows/jekyll.yml" target="blank">custom <code class="language-plaintext highlighter-rouge">jekyll.yml</code> workflow</a>.</p>

<p>After checking out the git repo and running <code class="language-plaintext highlighter-rouge">sed</code> as above, place these steps in the workflow <code class="language-plaintext highlighter-rouge">yml</code> to build and deploy the page:</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/jekyll-build-pages@v1-beta</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to github pages</span>
  <span class="na">uses</span><span class="pi">:</span> <span class="s">JeffIrwin/github-pages-deploy-action@4.1.8</span>
  <span class="na">with</span><span class="pi">:</span>
    <span class="na">branch</span><span class="pi">:</span> <span class="s">main</span>
    <span class="na">folder</span><span class="pi">:</span> <span class="s">.</span></code></pre></figure>

<p>Make sure to update the branch name that you’re deploying from if it’s not <code class="language-plaintext highlighter-rouge">main</code>.  Are you still naming branches <code class="language-plaintext highlighter-rouge">master</code> in 2022?  😩</p>

<p>I’m using <a href="https://github.com/marketplace/actions/deploy-to-github-pages" target="blank">JamesIves/github-pages-deploy-action</a> to deploy.  To guard against a <a href="https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code/" target="blank">left-pad fiasco</a>, I forked it and used <a href="https://github.com/JeffIrwin/pgh" target="blank"><code class="language-plaintext highlighter-rouge">pgh</code> git helper</a> to keep the fork up to date.</p>

<p>One downside of this non-default workflow is <a href="https://github.com/JeffIrwin/JeffIrwin.github.io/commit/37ff434518929afd3a0fef486d16eab1b3eab1c7" target="blank">all the junk bot commits</a>.  If you can figure out how to get rid of them, kudos to you.  The default Jekyll workflow doesn’t create junk commits like this, but its <code class="language-plaintext highlighter-rouge">yml</code> isn’t accessible to edit and add the <code class="language-plaintext highlighter-rouge">sed</code> commands.</p>

<p>Make sure to <code class="language-plaintext highlighter-rouge">pull</code> the changes locally after each junk commit.  If you’re like me, you’ll frequently forget to <code class="language-plaintext highlighter-rouge">pull</code> and end up with even more junk commits to <code class="language-plaintext highlighter-rouge">merge</code> the remote changes.</p>

<p><a href="https://github.com/JeffIrwin/JeffIrwin.github.io/tree/89f0290" target="blank">The full source for this site is here.</a></p>



      <footer class="site-footer">
        

        <p>
          Follow me on:
          <a href="https://github.com/JeffIrwin" target="_blank">GitHub</a>
           |
          <a href="https://www.threads.net/@jeff_irwin__" target="_blank">Threads</a>
           |
          <a href="https://www.tiktok.com/@jeff.irwin" target="_blank">TikTok</a>
           |
          <a href="https://www.youtube.com/channel/UCSQMQW8DomsFnTi4lNMa5iw" target="_blank">YouTube</a>
           |
          <a href="https://soundcloud.com/jirwin505" target="_blank">SoundCloud</a>
           |
          <a href="https://www.reddit.com/user/JeffIrwin" target="_blank">Reddit</a>
           |
          <a href="https://www.linkedin.com/in/jeff-irwin-54967332" target="_blank">LinkedIn</a>
           |
          <a href="https://vk.com/jei5028" target="_blank">VK</a>
        </p>

        <div style="display:none;"> <a rel="me" href="https://hachyderm.io/@jeffirwin">Mastodon</a> </div>

        <p>Build: Sat Feb  3 10:38:35 EST 2024, revision: <code>44e4b84</code></p>

      </footer>
    </main>
  </body>
</html>
